<!DOCTYPE html>
<html>
<head>
  <title>MobileApi</title>
  <%= csrf_meta_tags %>
  <%= javascript_include_tag "https://www.gstatic.com/firebasejs/4.1.3/firebase.js" %>
  <%= javascript_include_tag "https://www.gstatic.com/charts/loader.js" %>
  <%= javascript_include_tag "chartkick" %>
  <%= stylesheet_link_tag 'application', media: 'all', 'data-turbolinks-track': 'reload' %>
  <%= javascript_include_tag 'application', 'data-turbolinks-track': 'reload' %>
</head>

<body>


<% if session[:user_id].nil? %>
    <nav class="top-nav">
      <div class="nav-wrapper" style="background-color: #26a69a">
        <a href="#" class="brand-logo">LOGO</a>
      </div>
    </nav>
    <div class="row" style="min-height: 535px">
      <div class="col s8 offset-s2">
        <%= yield %>
      </div>
    </div>

    <footer class="page-footer" style="background-color: #26a69a; padding-top: 0;">
      <div class="footer-copyright">
        <div class="container">
          © 2014 Copyright Text
          <a class="grey-text text-lighten-4 right" href="#!">More Links</a>
        </div>
      </div>
    </footer>

<% else %>
    <header>
      <nav class="top-nav">
        <div class="nav-wrapper" style="background-color: #26a69a">
          <a href="#" class="brand-logo">LOGO</a>
          <% if session[:user_id].nil? %>
          <% else %>
              <ul class="left">
                <li>
                  <a href="#" data-activates="slide-out" id="slide_nav" class="button-collapse"><i class="material-icons">menu</i></a>
                </li>
              </ul>
              <ul id="notification_dropdown" class="dropdown-content" style="min-width: 250px">

              </ul>
              <ul class="right">
                <li>
                  <a class="dropdown-button" data-beloworigin="true"
                     constrainWidth="false" data-activates="notification_dropdown"><i class="material-icons">notifications</i></a>
                </li>
                <li>
                  <%= link_to logout_path, method: :delete do %>
                      <i class="material-icons">exit_to_app</i>
                  <% end %>
                </li>
              </ul>
          <% end %>
        </div>
      </nav>

      <ul class="side-nav fixed" id="slide-out" style="width: 250px; background-color: white; -webkit-box-shadow: 4px 0 5px -2px #888; box-shadow: 4px 0 5px -2px #888;">
        <li>
          <div class="userView">
            <div class="background">
              <img src="http://materializecss.com/images/office.jpg">
            </div>
            <a href="#!user"><img class="circle" src="http://materializecss.com/images/yuna.jpg"></a>
            <a href="#!name"><span class="white-text name"><%= session[:full_name] %></span></a>
            <a href="#!email"><span class="white-text email"><%= session[:email] %></span></a>
          </div>
        </li>
        <li class="no-padding">
          <%= link_to root_path do %>
              <i class="material-icons" style="margin-right: 10px">home</i><span>Home</span>
          <% end %>
        </li>
        <li>
          <div class="divider"></div>
        </li>
        <li class="no-padding" style="height: 5%;"><a href="#">MANAGE</a></li>
        <% if session[:role] == 'admin' %>
            <li class="no-padding">
              <%= link_to users_path do %>
                  <i class="material-icons" style="margin-right: 10px">supervisor_account</i><span>Users</span>
              <% end %>
            </li>
        <% else %>
            <li class="no-padding">
              <%= link_to dashboard_path do %>
                  <i class="material-icons" style="margin-right: 10px">dashboard</i><span>Dashboard</span>
              <% end %>
            </li>
            <li class="no-padding">
              <%= link_to dishes_path do %>
                  <i class="material-icons" style="margin-right: 10px">restaurant_menu</i><span>Dishes</span>
              <% end %>
            </li>
            <li class="no-padding">
              <%= link_to tables_path do %>
                  <i class="material-icons" style="margin-right: 10px">event_seat</i><span>Tables</span>
              <% end %>
            </li>
            <li class="no-padding">
              <%= link_to price_change_histories_path do %>
                  <i class="material-icons" style="margin-right: 10px">attach_money</i><span>Prices</span>
              <% end %>
            </li>
            <li class="no-padding">
              <%= link_to discount_days_path do %>
                  <i class="material-icons" style="margin-right: 10px">event</i><span>Discount Days</span>
              <% end %>
            </li>
            <li class="no-padding">
              <%= link_to memberships_path do %>
                  <i class="material-icons" style="margin-right: 10px">card_membership</i><span>Memberships</span>
              <% end %>
            </li>
        <% end %>
      </ul>

    </header>
    <main>
      <div style="margin-bottom: 2%; margin-top: 1%; min-height: 520px">
        <%= yield %>
      </div>

      <footer class="page-footer" style="background-color: #26a69a; padding-top: 0;">
        <div class="footer-copyright">
          <div class="container">
            © 2014 Copyright Boe team
          </div>
        </div>
      </footer>
    </main>
<% end %>
</body>
</html>
<script>
    function appendNotification(text) {
        $('#notification_dropdown').prepend('<li><a href="#">' + text + '</a></li>')
    }
    var config = {
        apiKey: "AIzaSyB9OrnpLwPlNy3ldhwfb5BMS2PRAV1o9j4",
        authDomain: "boebackend.firebaseapp.com",
        databaseURL: "https://boebackend.firebaseio.com",
        projectId: "boebackend",
        storageBucket: "boebackend.appspot.com",
        messagingSenderId: "827854885414"
    };
    firebase.initializeApp(config);
    var data = firebase.database().ref().child('Phongdemo');
    data.on('child_added', function (snapshot) {
        console.log(snapshot.child('type').val());
        console.log(snapshot.child('type').val() == 'unread');
        if(snapshot.child('type').val() == 'unread'){
            appendNotification(snapshot.child('text').val())
        }
    });
</script>
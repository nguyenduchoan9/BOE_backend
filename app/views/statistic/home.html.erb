<style>
  label {
    font-weight: bold;
  }
</style>
<div class="row">
  <div class="left" style="margin-left: 1%; font-size: 18px;">
    <%= render_breadcrumbs :separator => ' > ' %>
  </div>
  <div class="col s5 right">
    <div class="input-field" style="margin-top: 0">
      <%= form_tag(home_path, method: :get) do %>
          <%= text_field_tag :term, params[:term], style: 'width: 80%;', placeholder: 'Search', class: 'datepicker', id: "date_search" %>
          <button type="submit" class="btn-floating waves-effect waves-light" onclick="update_notification()">
            <i class="material-icons">search</i>
          </button>
      <% end %>
    </div>
  </div>
</div>
<div style="padding: 0% 5%">
  <% if !@orders.nil? && @orders.size > 0 %>
      <div class="card">
        <div class="card-content">
          <span class="card-title">Rejected Order</span>
          <table id="table" class="bordered striped">
            <thead>
            <th style="text-align: center; width: 15%">Table Number</th>
            <th style="text-align: center; width: 55%">Dish Name</th>
            <th style="text-align: center">Total</th>
            <th></th>
            </thead>
            <tbody id="tbody">
            <% @orders.each do |order| %>
                <% dish_name = Array.new %>
                <% total = 0 %>
                <% order.order_details.each do |o| %>
                    <% dish_name.push("#{o.dish.dish_name} x #{o.quantity_not_serve}") %>
                    <% total += (o.price * o.quantity_not_serve) %>
                <% end %>
                <tr>
                  <td style="text-align: center"><%= order.table_number %></td>
                  <td><%= dish_name.join(", ") %></td>
                  <td style="text-align: center"><%= number_to_currency(total, unit: '', precision: 0) %></td>
                  <td>
                    <a href="refund?order_id=<%= order.id %>">
                      <button class="btn red">Refund</button>
                    </a>
                  </td>
                </tr>
            <% end %>
            </tbody>
          </table>
        </div>
      </div>
  <% elsif !params[:term].nil? %>
      <h5 id="available" style="text-align: center;">Not Available</h5>
  <% end %>
</div>
<script>
    //    function update_notification() {
    //        $('#title_date').text($('#date_search').val());
    //        $('#table').css('display', 'none');
    //        $('#available').css('display', '');
    //        $('#table').find("tr:gt(0)").remove();
    //        data = firebase.database().ref().child('rejectedOrder');
    //        data.once('value').then(function (snapshot1) {
    //            snapshot1.forEach(function (snapshot) {
    //                if ($('#title_date').text() == snapshot.child('date').val()) {
    //                    $('#tbody').prepend('<tr><td style="text-align: center">' + snapshot.child('tableNumber').val() + '</td><td style="text-align: center">' + snapshot.child('dishName').val() +
    //                        '</td><td style="text-align: center">' + snapshot.child('price').val() + '</td><td style="text-align: center">' + snapshot.child('quantity').val() + '</td><td style="text-align: center">' + snapshot.child('quantity').val() * snapshot.child('price').val() + '</td>' +
    //                        '<td class="center"><a href="refund?order_detail_id=' + snapshot.child('order_detail_id').val() + '&fcm=' + snapshot.key + '"><button class="btn red">Refund</button></a></td></tr>');
    //                    $('#table').css('display', '');
    //                    $('#available').css('display', 'none');
    //                }
    //            });
    //        });
    //    }
    //    $(document).ready(function () {
    //        var update = {};
    //        update['/number'] = 0;
    //        firebase.database().ref().update(update);
    //        data = firebase.database().ref().child('rejectedOrder');
    //        data.on('child_added', function (snapshot) {
    //            if ($('#title_date').text() == snapshot.child('date').val()) {
    //                $('#tbody').prepend('<tr><td style="text-align: center">' + snapshot.child('tableNumber').val() + '</td><td style="text-align: center">' + snapshot.child('dishName').val() +
    //                    '</td><td style="text-align: center">' + snapshot.child('price').val() + '</td><td style="text-align: center">' + snapshot.child('quantity').val() + '</td><td style="text-align: center">' + snapshot.child('quantity').val() * snapshot.child('price').val() + '</td>' +
    //                    '<td class="center"><a href="refund?order_detail_id=' + snapshot.child('order_detail_id').val() + '&fcm=' + snapshot.key + '"><button class="btn red">Refund</button></a></td></tr>');
    //                $('#table').css('display', '');
    //                $('#available').css('display', 'none');
    //            }
    //        });
    //    });
    var $input = $('.datepicker').pickadate({
        format: 'dd/mm/yyyy',
        selectMonths: true, // Creates a dropdown to control month
        selectYears: 15 // Creates a dropdown of 15 years to control year
    });
    //    var picker = $input.pickadate('picker');
    //    picker.set('select', $('#today').val());
    //    $('#title_date').text($('#date_search').val());
</script>
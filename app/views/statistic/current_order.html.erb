<style>
  label {
    font-weight: bold;
  }

  [type="radio"]:not(:checked) + label, [type="radio"]:checked + label {
    margin-right: 3%;
  }
</style>
<div id="refund_method" class="modal modal-fixed-footer" style="min-height: 50% !important;">
  <form action="cancel_order" method="get">
    <div class="modal-content">
      <h4 class="center">Refund Method</h4>
      <div class="input-field" style="width: 50%; margin-top: 5%">
        <input type="number" readonly id="refund_amount" placeholder="Amount">
        <label for="refund_method">Amount</label>
      </div>
      <span style="font-weight: bold; margin-right: 5%">Refund Method:</span>
      <input class="with-gap" name="refund_method_radio" type="radio" id="test1"/><label for="test1">Paypal</label>
      <input class="with-gap" name="refund_method_radio" type="radio" id="test2"/><label for="test2">Balance</label>
      <input class="with-gap" name="refund_method_radio" type="radio" id="test3"/><label for="test3">Cash</label>
      <input type="hidden" id="order_id" name="order_id">
      <input type="hidden" id="term_id" name="term_id">
      <input type="hidden" id="type_id" name="type_id">
    </div>
    <div class="modal-footer">
      <input type="button" class="modal-action modal-close btn-flat" value="cancel">
      <input type="submit" class="modal-action btn-flat" value="Refund" onclick="$('#refund_method').modal('close');$('#unclose_modal').modal('open')">
    </div>
  </form>
</div>
<div id="unclose_modal" class="modal">
  <div class="modal-content" style="text-align: center;">
    <h5>Please Wait...</h5>
    <div class="preloader-wrapper big active">
      <div class="spinner-layer spinner-blue-only">
        <div class="circle-clipper left">
          <div class="circle"></div>
        </div>
        <div class="gap-patch">
          <div class="circle"></div>
        </div>
        <div class="circle-clipper right">
          <div class="circle"></div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="row">
  <div class="left" style="margin-left: 1%; font-size: 18px;">
    <%= render_breadcrumbs :separator => ' > ' %>
  </div>
  <div class="col s6 right">
    <div class="input-field" style="margin-top: 0">
      <%= form_tag(current_order_path, method: :get) do %>
          <%= text_field_tag :term, params[:term], style: 'width: 60%;', placeholder: 'Search', data: {autocomplete_source: Dish.order(:dish_name).map(&:dish_name)} %>
          <div class="col s3">
            <select name="type" onchange="onSelectType()" id="type">
              <% if params[:type] == "dish" %>
                  <option value="dish" selected>Dish</option>
              <% else %>
                  <option value="dish">Dish</option>
              <% end %>
              <% if params[:type] == "table" %>
                  <option value="table" selected>Table</option>
              <% else %>
                  <option value="table">Table</option>
              <% end %>
            </select>
          </div>
          <button type="submit" class="btn-floating waves-effect waves-light">
            <i class="material-icons">search</i>
          </button>
      <% end %>
    </div>
  </div>
</div>
<div style="padding: 0% 5%">
  <% if (!@orders.nil? && @orders.size > 0) || (!@order_details.nil? && @order_details.size > 0) %>
      <div class="card">
        <div class="card-content">
          <span class="card-title">Current Order</span>
          <% if params[:type] == "table" %>
              <table id="table" class="bordered striped">
                <thead>
                <th style="text-align: center;">User</th>
                <th style="text-align: center;">Dish</th>
                <th style="text-align: center;">Quantity</th>
                <th></th>
                </thead>
                <tbody id="tbody">
                <% @order_details.each do |order_detail| %>
                    <tr>
                      <td><%= order_detail.order.user.username %></td>
                      <td><%= order_detail.dish.dish_name %></td>
                      <td style="text-align: center"><%= order_detail.quantity_not_serve %></td>
                      <td style="text-align: center">
                        <button class="red btn" onclick="var type = $('#type').find(':selected').val(); $('#term_id').val($('#term').val());$('#type_id').val(type);$('#order_id').val(<%=order_detail.id %>);$('#refund_amount').val(<%=order_detail.price * order_detail.quantity_not_serve %>);$('#refund_method').modal('open')">Cancel</button>
                      </td>
                    </tr>
                <% end %>
                </tbody>
              </table>
          <% elsif params[:type] == "dish" %>
              <table id="table" class="bordered striped">
                <thead>
                <th style="text-align: center; width: 15%">Table Number</th>
                <th style="text-align: center;">User</th>
                <th style="text-align: center;">Quantity</th>
                <th></th>
                </thead>
                <tbody id="tbody">
                <% @order_details.each do |order_detail| %>
                    <tr>
                      <td style="text-align: center"><%= order_detail.order.table_number %></td>
                      <td style="text-align: center"><%= order_detail.order.user.username %></td>
                      <td style="text-align: center"><%= order_detail.quantity_not_serve %></td>
                      <td style="text-align: center">
                        <button class="red btn" onclick="var type = $('#type').find(':selected').val(); $('#term_id').val($('#term').val());$('#type_id').val(type);$('#order_id').val(<%=order_detail.id %>);$('#refund_amount').val(<%=order_detail.price * order_detail.quantity_not_serve %>);$('#refund_method').modal('open')">Cancel</button>
                      </td>
                    </tr>
                <% end %>
                </tbody>
              </table>
          <% end %>
        </div>
      </div>
  <% elsif !params[:term].nil? %>
      <h5 id="available" style="text-align: center;">Not Available</h5>
  <% end %>
</div>
<script>
    $('#term').autocomplete({
        source: $('#term').data('autocomplete-source')
    });

    function onSelectType() {
        var selected = $('#type').find(":selected").text();
        if (selected == "Dish") {
            $('#term').autocomplete({
                source: $('#term').data('autocomplete-source')
            });
        } else {
            console.log("destroy");
            $('#term').autocomplete({disabled: true});
        }
    }
</script>